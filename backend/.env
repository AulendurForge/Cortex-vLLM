# =========================
# Cortex Gateway (FastAPI)
# =========================

# Comma-separated list of vLLM text-generation endpoints (internal URLs in dev compose)
VLLM_GEN_URLS=http://vllm-gen:8000

# Comma-separated list of vLLM embedding endpoints
VLLM_EMB_URLS=http://vllm-emb:8000

# Internal token the gateway uses to authenticate to vLLM (not user keys)
INTERNAL_VLLM_API_KEY=dev-internal-token

# Allow any presented API key in dev (simplifies local testing).
# Set to false in production and use real key mgmt.
GATEWAY_DEV_ALLOW_ALL_KEYS=true

# Maximum allowed HTTP request body size (bytes).
# 8 MiB is a good default for prompts/batched requests.
REQUEST_MAX_BODY_BYTES=8388608

# -------------------------
# Rate limiting (optional)
# -------------------------
# Enable simple rate limiting backed by Redis.
RATE_LIMIT_ENABLED=false
# Sustained requests per second allowed per client/key.
RATE_LIMIT_RPS=10
# Short burst capacity allowed above RPS.
RATE_LIMIT_BURST=20
# Sliding window length in seconds (0 disables window check).
RATE_LIMIT_WINDOW_SEC=0
# Max requests within the sliding window (active only if WINDOW_SEC > 0).
RATE_LIMIT_MAX_REQUESTS=0

# Redis connection URL for rate limiting and other features.
REDIS_URL=redis://redis:6379/0

# -------------------------
# Concurrency caps (stream)
# -------------------------
# Limit concurrent streaming responses per identifier (e.g., key or user).
CONCURRENCY_LIMIT_ENABLED=false
MAX_CONCURRENT_STREAMS_PER_ID=5

# -------------------------
# Circuit breaker (simple)
# -------------------------
# Breaker opens after this many consecutive failures to an upstream.
CB_ENABLED=false
CB_FAILURE_THRESHOLD=5
# Cooldown in seconds before half-open retries.
CB_COOLDOWN_SEC=30

# -------------------------
# Health polling for upstreams
# -------------------------
# Health cache TTL (seconds) used for readiness checks.
HEALTH_CHECK_TTL_SEC=10
# Path to hit when polling upstream engines.
HEALTH_CHECK_PATH=/health
# Background health poll interval (0 disables polling).
HEALTH_POLL_SEC=15

# -------------------------
# Observability
# -------------------------
# Prometheus base URL used by admin/system endpoints for metrics queries.
PROMETHEUS_URL=http://prometheus:9090

# OpenTelemetry (disabled by default in dev).
OTEL_ENABLED=false
OTEL_SERVICE_NAME=cortex-gateway
OTEL_EXPORTER_OTLP_ENDPOINT=

# If engine responses omit token usage, estimate on gateway side.
TOKEN_ESTIMATION_ENABLED=true

# -------------------------
# CORS & security headers
# -------------------------
# Enable CORS and allow the dev UI origin.
CORS_ENABLED=true
CORS_ALLOW_ORIGINS="http://localhost:3001"
# Add standard security headers to responses.
SECURITY_HEADERS_ENABLED=true

# -------------------------
# Database (PostgreSQL)
# -------------------------
# Async SQLAlchemy URL (dev compose connection).
DATABASE_URL=postgresql+asyncpg://cortex:cortex@postgres:5432/cortex

# -------------------------
# Admin bootstrap (dev only)
# -------------------------
# If present, creates/updates a local admin on startup (no effect in prod setups).
ADMIN_BOOTSTRAP_USERNAME=admin
ADMIN_BOOTSTRAP_PASSWORD=admin
ADMIN_BOOTSTRAP_ORG=HAF